## 一页梳理版：大模型 Agent 与 Multi Agent

### 0. 本章要解决的真实痛点

* 你把“工作总结”交给模型写周报仍要手动发邮件
* Agent 的价值在于把“生成内容”升级为“完成流程”，包括调用工具与外部系统交互，例如邮件发送、发布、查询、执行代码、写入数据库

---

## 课程目标

* 知道 Agent 是什么，能解决什么问题
* 理解记忆、规划、工具如何组合成可落地系统
* 形成对单 Agent 与多 Agent 的工程化直觉，能联想到业务创新点

---

# 1. 认识大模型 Agent

## 1.1 Agent 的定义

从软件工程视角：**基于大语言模型、具备工具调用能力、能与外部世界交互的程序**。
类比：LLM 是大脑，工具是四肢。Agent 把“回答”变成“行动”。

### Agent 的典型组件

* **感知 Perception**：输入来自对话、传感器、日志、文件、网页、数据库结果
* **推理 Reasoning**：理解意图、做决策、生成计划、选择工具
* **行动 Action**：调用工具执行真实动作
* 常见增强：**记忆 Memory** 与 **规划 Planning**

---

## 1.2 让 Agent 具备记忆能力

### 1.2.1 短期记忆 Short Term

* 对应：当前会话的历史对话、提示词、工具返回结果
* 限制由上下文窗口决定
* 两类典型问题

  * **上下文有限**导致“刚说过就忘”
  * **recency 偏置**导致长上下文里前部信息权重低，关键事实被忽略
    工程含义：需要做“压缩、筛选、摘要、检索”而不是无限堆上下文

### 1.2.2 长期记忆 Long Term

* 对应：持久化的业务记录、知识库、向量库与文档库
* 目标：让 Agent 能回答私有知识与垂直领域问题
* 典型手段：RAG 召回相关片段，再交给模型生成

---

## 1.3 让 Agent 具备规划能力

### 1.3.1 任务分解的三种代表结构

* **CoT 思维链**：一步一步拆解，适合确定性较强的多步任务
* **ToT 思维树**：每步生成多方案，进行分支探索与选择，适合不确定性与多路径决策
* **GoT 思维图**：允许回溯、剪枝、合并重复节点，是对 ToT 的工程优化

工程视角要点：任务越复杂，越需要“可观测的分步执行”来监控、回滚与纠错。

### 1.3.2 推理与反思

* 核心思想：输出前自检，类似人写作前反复回读
* 代表方法：**ReAct（Reasoning + Acting）**

  * Thought：思考下一步
  * Action：选择工具与调用
  * Observation：读取工具结果
  * 循环：直到完成任务
* ReAct 的关键是把“思考、行动、观察”写入统一提示词模版，使系统可控、可追踪。

---

## 1.4 Agent 相对普通 LLM 的差异总结

1. 能做真实动作，不局限于文本输出
2. 能主动规划与纠错，支持长链路任务闭环
3. 能处理复杂任务，靠分解与工具执行来稳定输出
4. 能在系统层积累经验，形成长期偏好与规则
5. 能接入私域知识与业务工具，变成领域助手

---

# 2. Agent 应用场景

## 2.1 低复杂度

* 发邮件、查天气、整理文档、生成会议纪要、创建任务清单

## 2.2 中高复杂度的典型流水线

以“写文章并发布”为例的 10 步链路：选题调研 → 资料整理 → 大纲 → 初稿 → 润色 → SEO → 发布 → 标题摘要 → 监控反馈 → 迭代。
关键价值：把内容生产从“单次生成”改为“流程化交付”。

---

# 3. 单 Agent 框架落地示例：ModelScope Agent

## 3.1 框架提供的能力边界

* 角色扮演、LLM 调用、工具使用、规划、记忆
* 只需指定：角色描述 + 模型 + 工具列表
* 内置：网页浏览、搜索、代码解释器、多模态生成等工具
  工程含义：把“编排工作流”从业务代码中抽出来，形成可扩展框架层。

---

# 4. Multi Agent

## 4.1 为什么需要多智能体

单 Agent 全程做调研、写作、校对，常见问题是：

* 信息质量不可控
* 自己写自己审容易漏错
* 长链路注意力漂移导致一致性下降
  多 Agent 用分工降低认知负载，强化交叉审查。

## 4.2 一个可复用的多 Agent 结构

* Research Specialist：事实收集与引用整理
* Content Creator：结构化写作与论证
* Grammatical Checker：语言与逻辑错误拦截，必要时打回
* Proofreading Specialist：终审，确保可发布标准
  工程关键：角色职责清晰 + 交付物格式清晰 + 反馈回路明确。

## 4.3 项目示例的定位

* **MetaGPT**：一个提示词组建“软件开发团队”，自动产出代码与文档
* **AgentScope**：多智能体开发平台，支持分布式、工具、检索、代码执行等，偏工程系统化
* 其他：Camel AI、AutoGen、AgentVerse、斯坦福小镇，覆盖从工程到社会仿真

---

# 5. 不断完善 Agent 系统的三条工程主线

## 5.1 控制上下文与信息密度

* 不是上下文越长越好
* 需要“精简、摘要、检索、结构化”来提升有效信息命中率，降低 token 成本与噪音干扰

## 5.2 强化规划与过程治理

* 需要可度量的拆解深度标准
* 需要链路监控、失败检测、终止条件
* 需要人类介入点：授权级别、确认点、回滚机制

## 5.3 混合多模型降低成本

* 识别、分类、抽取可用小模型
* 复杂推理与最终写作用大模型
* 以“任务难度与成本”做路由，系统成本会显著下降

---

## 本章最重要的结论

Agent 是把大模型从“生成答案”推进到“执行任务闭环”的系统形态。
落地的关键不在于模型更聪明，而在于：**工具接口、记忆机制、规划编排、失败治理、成本路由**这些软件工程能力是否扎实。

如果你要继续写下一章，建议顺序是：安全合规 → 权限与审计 → 失败回滚与人工接管 → 可观测性与评测指标，这会让 Agent 从 Demo 走向生产。